output_units:
  pressure: kPag
  pressure_drop: kPa
  temperature: degC
  density: kg/m^3
  velocity: m/s
  volumetric_flow_rate: m^3/h
  mass_flow_rate: kg/h
  flow_momentum: Pa
  gas_flow_critical_pressure: kPa
  length: m
  small_length: mm
  
system_solver:
  max_iterations: 6
  tolerance: 0.5
  relaxation: 0.7

system_optimizer:
  enable: true
  tolerance: 500.0
  damping_factor: 0.65
  max_iterations: 20
  networks:
    supply:
      method: advanced
      downstream_pressure:
        value: 330
        unit: kPag
    branch:
      method: simple

networks:
  - id: supply
    name: upstream_supply
    description: Primary loop feeding downstream users
    primary: true
    direction: forward
    boundary_pressure:
      value: 350
      unit: kPag
    boundary_temperature:
      value: 35
      unit: degC
    mass_flow_rate:
      value: 1.5
      unit: kg/s
    fluid:
      name: treated_water
      phase: liquid
      density:
        value: 998
        unit: kg/m^3
      viscosity: 8.9e-4
    sections:
      - id: supply-001
        description: Pump discharge to junction
        schedule: "40"
        pipe_NPD: 6.0
        roughness: 4.5e-5
        length:
          value: 25
          unit: m
        elevation_change:
          value: 1.5
          unit: m
        fitting_type: LR
        fittings:
          - {type: pipe_entrance_normal, count: 1}
          - {type: elbow_90, count: 2}
        from_node_id: source
        to_node_id: junction
      - id: supply-002
        description: Junction to header outlet
        schedule: "40"
        pipe_NPD: 6.0
        roughness: 4.5e-5
        length:
          value: 10
          unit: m
        elevation_change:
          value: -0.5
          unit: m
        fitting_type: LR
        fittings:
          - {type: tee_through, count: 1}
          - {type: pipe_exit, count: 1}
        from_node_id: junction
        to_node_id: supply_outlet

  - id: branch
    name: downstream_branch
    description: User branch that taps the supply junction
    direction: forward
    boundary_pressure:
      value: 220
      unit: kPag
    boundary_temperature:
      value: 35
      unit: degC
    mass_flow_rate:
      value: 0.8
      unit: kg/s
    fluid:
      name: treated_water
      phase: liquid
      density:
        value: 998
        unit: kg/m^3
      viscosity: 8.9e-4
    sections:
      - id: branch-001
        description: Junction to control valve
        schedule: "40"
        pipe_NPD: 4.0
        roughness: 4.5e-5
        length:
          value: 12
          unit: m
        elevation_change:
          value: -0.3
          unit: m
        fitting_type: LR
        fittings:
          - {type: tee_elbow, count: 1}
          - {type: elbow_90, count: 1}
        from_node_id: junction
        to_node_id: valve_inlet
      - id: branch-002
        description: Control valve to user outlet
        schedule: "40"
        pipe_NPD: 4.0
        roughness: 4.5e-5
        length:
          value: 8
          unit: m
        elevation_change:
          value: 0.0
          unit: m
        fitting_type: LR
        fittings:
          - {type: elbow_45, count: 2}
        control_valve:
          tag: CV-201
          pressure_drop:
            value: 20
            unit: kPa
        from_node_id: valve_inlet
        to_node_id: user_outlet

links:
  - id: supply_to_branch
    members:
      - network: supply
        node: junction
      - network: branch
        node: junction
